!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.FormFileUpload=t()}(this,function(){var e=function(e,t){"use strict";var n,i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=",r=0,a={fileNumber:0,requestSize:0},o=this,l=document.querySelector(".js_dropbox"),s=document.querySelector(".js_list"),d=document.querySelector(".js_fileinputs"),u=document.querySelector(".js_form"),c=document.createElement("div"),f=document.createElement("div"),m={errorMessageTimeout:5e3,maxFileSize:3145728,maxFileNumber:3,thumbnailSize:100,maxRequestSize:9437184,fallbackForIE8:!0,fileNameRe:/^[A-Za-z0-9.\-_ ]+$/,invalidFileNameError:"The name of the file has forbidden characters",invalidFileTypeError:"The fileformat is not allowed",maxRequestSizeError:"The requestsize of the files you want to upload is exceeded.",maxFileNumberError:"You can upload 3 files, not more!",maxFileSizeError:"One of the files is too large. the maximum filesize is 3 MB.",unknownFileReaderError:"Unknown Error while loading the file.",acceptedTypes:{"image/png":"PNG-Bild","image/jpeg":"JPEG-Bild","image/gif":"GIF-Bild","image/tiff":"TIFF-Bild","application/pdf":"PDF-Dokument","application/vnd.ms-excel":"Excel-Dokument","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel-Dokument","application/msword":"Word-Dokument","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word-Dokument"}},p=function(e,t,n){var i={};for(var r in t)e&&e.hasOwnProperty(r)?(i[r]=e[r],"function"==typeof i[r]&&(i[r]=i[r].bind(n))):i[r]=t[r];return i},h=function(e){return/\.xls$/.test(e.name)&&!e.type?"application/vnd.ms-excel":e.type},v=function(e){var t,n=e.size;return n>=1099511627776?(n/=109951162777.6,t="TB"):n>=1073741824?(n/=107374182.4,t="GB"):n>=1048576?(n/=104857.6,t="MB"):n>=1024?(n/=102.4,t="KB"):(n=10*n,t="B"),Math.round(n)/10+" "+t},A=function(){return!!(window.File&&window.FileList&&window.FileReader)},E=function(e){var t=document.createElement("input");return t.type="file",t.className="fileinput",t.name="fileinput-"+e,e+=1,t},g=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():(e.returnValue=!1,!1)},F=function(e){return Array.prototype.slice.call(e,0)},b=function(e){return/^image\//.test(h(e))},S=p(t,m,o),w=function(e){a.fileNumber+=1,a.requestSize+=e.size},x=function(e){a.fileNumber-=1,a.requestSize-=e.size},y=function(e){var t=document.createElement("input");return t.type="hidden",t.value=e.data,t.name="file:"+e.file.name,u.appendChild(t),function(){t.parentNode.removeChild(t)}},N=function(e,t,n){var i=document.createElement("span");i.className="remove",n.appendChild(i),s.appendChild(n),i.addEventListener("click",function(){t(a),n.parentNode.removeChild(n),x(e.file)})},z=function(e,t,n){var r=document.createElement("canvas"),a=window.devicePixelRatio,o=document.createElement("span");o.className="thumbnail";var l=new FileReader,s=r.getContext("2d");r.width=n.thumbnailSize*a,r.height=n.thumbnailSize*a,a>1&&(s.webkitBackingStorePixelRatio=a,s.scale(a,a));var d=new Image;d.addEventListener("load",function(){var e=this.height/this.width;r.height=r.width*e,s.drawImage(this,0,0,n.thumbnailSize*a,n.thumbnailSize*e*a)});var u=t.querySelector(".js_name");l.addEventListener("load",function(n){d.src=b(e)?n.target.result:i,o.appendChild(r),t.insertBefore(o,u)}),l.readAsDataURL(e)},T=function(e,t,n){var i=document.createElement("li");return i.className="file",i.innerHTML=['<span class="label js_name name">',e,'</span><span class="label size">',t,'</span><span class="label type">',n,"</span>"].join(""),i},L=function(e,t){return t.acceptedTypes[e]||"unknown filetype"},B=function(e,t){return e.fileNumber>=t.maxFileNumber?!1:!0},R=function(e,t){return e>=t.maxRequestSize?!1:!0},C=function(e,t){return t.acceptedTypes[e]?!0:!1},k=function(e,t){return e.size>t.maxFileSize?!1:!0},q=function(e,t){return t.fileNameRe.test(e.name)?!0:!1},M=function(e){e.innerHTML=""},j=function(e){var t=document.createElement("li");t.className="error",t.innerHTML=e,clearTimeout(n),n=setTimeout(function(){M(c)},S.errorMessageTimeout),c.appendChild(t),u.insertBefore(c,s)},U=function(e,t){if(e&&console.log(e),t){var n=y(t),i=L(h(t.file),S),r=T(t.file.name,v(t.file),i);N(t,n,r),A()&&z(t.file,r,S)}},D=function(e){return B(a,S)?R(a,S)?C(h(e),S)?k(e,S)?q(e,S)?!0:S.invalidFileNameError:S.maxFileSizeError:S.invalidFileTypeError:S.maxRequestSizeError:S.maxFileNumberError};if(this.convertFilesToBase64=function(e){e.every(function(e){var t=new FileReader;return"string"==typeof D(e)?(j(D(e)),!1):(w(e),t.addEventListener("load",function(t){U(null,{data:t.target.result,file:e})}),t.addEventListener("error",function(){U(S.unknownFileReaderError)}),t.readAsDataURL(e),!0)})},this.addSelectedFile=function(){var e=E(r);u.insertBefore(f,l),f.appendChild(e),e.addEventListener("change",function(){M(c);var t=this.files[0],n={file:t},i=function(){x(t,a),e.parentNode.removeChild(e)};if("string"==typeof D(t))j(D(t),S.errorTimeoutId,M,c,u,s,S),e.parentNode.removeChild(e);else{var r=L(h(t),S),l=T(t.name,r,v(n.file));w(t,a),N(n,i,l),A()&&z(t,l,S),d.appendChild(e)}o.addSelectedFile()})},!A()&&S.fallbackForIE8){f.className="selectbutton js_selectbutton";var I=document.createElement("span");I.innerHTML="Select File",f.appendChild(I),o.addSelectedFile(),l.style.display="none"}l.addEventListener("drop",function(e){g(e);var t=F(e.dataTransfer.files);o.convertFilesToBase64(t),this.classList.toggle("active")}),l.addEventListener("dragenter",function(e){g(e),this.classList.toggle("active")}),l.addEventListener("dragover",function(e){g(e)}),l.addEventListener("dragleave",function(e){g(e),this.classList.toggle("active")})};return $.fn.formFileUpload=function(t){"use strict";return this.each(function(){var n;$.data(this,"formFileUpload")||(n=$.extend({},t,$(this).data()),$.data(this,"formFileUpload",new e(this,n)))})},e});