!function(e,n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define([],n):e.FormFileUpload=n()}(this,function(){var e=function(e,n){"use strict";var t,i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAApJREFUCNdjYAAAAAIAAeIhvDMAAAAASUVORK5CYII=",r=0,a={fileNumber:0,requestSize:0},o=this,l=document.querySelector(".js_dropbox"),s=document.querySelector(".js_list"),u=document.querySelector(".js_fileinputs"),d=document.querySelector(".js_form"),c=document.createElement("div"),m=document.createElement("div"),f={errorMessageTimeout:5e3,maxFileSize:3145728,maxFileNumber:3,thumbnailSize:100,maxRequestSize:9437184,fallbackForIE8:!0,fileNameRe:/^[A-Za-z0-9.\-_ ]+$/,invalidFileNameError:"The name of the file has forbidden characters",invalidFileTypeError:"The fileformat is not allowed",maxRequestSizeError:"The requestsize of the files you want to upload is exceeded.",maxFileNumberError:"You can upload 3 files, not more!",maxFileSizeError:"One of the files is too large. the maximum filesize is 3 MB.",unknownFileReaderError:"Unknown Error while loading the file.",acceptedTypes:{"image/png":"PNG-Bild","image/jpeg":"JPEG-Bild","image/gif":"GIF-Bild","image/tiff":"TIFF-Bild","application/pdf":"PDF-Dokument","application/vnd.ms-excel":"Excel-Dokument","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"Excel-Dokument","application/msword":"Word-Dokument","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"Word-Dokument"}},p=function(e,n,t){var i={};for(var r in n)e&&e.hasOwnProperty(r)?(i[r]=e[r],"function"==typeof i[r]&&(i[r]=i[r].bind(t))):i[r]=n[r];return i},v=function(e){return/\.xls$/.test(e.name)&&!e.type?"application/vnd.ms-excel":e.type},h=function(e){var n,t=e.size;return t>=1099511627776?(t/=109951162777.6,n="TB"):t>=1073741824?(t/=107374182.4,n="GB"):t>=1048576?(t/=104857.6,n="MB"):t>=1024?(t/=102.4,n="KB"):(t=10*t,n="B"),Math.round(t)/10+" "+n},A=function(){return!!(window.File&&window.FileList&&window.FileReader)},E=function(e){var n=document.createElement("input");return n.type="file",n.className="fileinput",n.name="fileinput-"+e,e+=1,n},g=function(e){return e.stopPropagation(),e.preventDefault?e.preventDefault():(e.returnValue=!1,!1)},F=function(e){return Array.prototype.slice.call(e,0)},b=function(e){return/^image\//.test(v(e))},S=p(n,f,o),y=function(e){a.fileNumber+=1,a.requestSize+=e.size},w=function(e){a.fileNumber-=1,a.requestSize-=e.size},x=function(e){var n=document.createElement("input");return n.type="hidden",n.value=e.data,n.name="file:"+e.file.name,d.appendChild(n),function(){n.parentNode.removeChild(n)}},N=function(e,n,t){var i=document.createElement("span");i.className="remove",t.appendChild(i),s.appendChild(t),i.addEventListener("click",function(){n(a),t.parentNode.removeChild(t),w(e.file)})},z=function(e,n,t){var r=document.createElement("canvas"),a=window.devicePixelRatio,o=document.createElement("span");o.className="thumbnail";var l=new FileReader,s=r.getContext("2d");r.width=t.thumbnailSize*a,r.height=t.thumbnailSize*a,a>1&&(s.webkitBackingStorePixelRatio=a,s.scale(a,a));var u=new Image;u.addEventListener("load",function(){var e=this.height/this.width;r.height=r.width*e,s.drawImage(this,0,0,t.thumbnailSize*a,t.thumbnailSize*e*a)});var d=n.querySelector(".js_name");l.addEventListener("load",function(t){u.src=b(e)?t.target.result:i,o.appendChild(r),n.insertBefore(o,d)}),l.readAsDataURL(e)},T=function(e,n,t){var i=document.createElement("li");return i.className="file",i.innerHTML=['<span class="label js_name name">',e,'</span><span class="label size">',n,'</span><span class="label type">',t,"</span>"].join(""),i},L=function(e,n){return n.acceptedTypes[e]||"unknown filetype"},B=function(e,n){return e.fileNumber>=n.maxFileNumber?!1:!0},R=function(e,n){return e>=n.maxRequestSize?!1:!0},C=function(e,n){return n.acceptedTypes[e]?!0:!1},k=function(e,n){return e.size>n.maxFileSize?!1:!0},q=function(e,n){return n.fileNameRe.test(e.name)?!0:!1},M=function(e){e.innerHTML=""},j=function(e){var n=document.createElement("li");n.className="error",n.innerHTML=e,clearTimeout(t),t=setTimeout(function(){M(c)},S.errorMessageTimeout),c.appendChild(n),d.insertBefore(c,s)},D=function(e,n){if(e&&console.log(e),n){var t=x(n),i=L(v(n.file),S),r=T(n.file.name,h(n.file),i);N(n,t,r),A()&&z(n.file,r,S)}},I=function(e){return B(a,S)?R(a,S)?C(v(e),S)?k(e,S)?q(e,S)?!0:S.invalidFileNameError:S.maxFileSizeError:S.invalidFileTypeError:S.maxRequestSizeError:S.maxFileNumberError};if(this.convertFilesToBase64=function(e){e.every(function(e){var n=new FileReader;return"string"==typeof I(e)?(j(I(e)),!1):(y(e),n.addEventListener("load",function(n){D(null,{data:n.target.result,file:e})}),n.addEventListener("error",function(){D(S.unknownFileReaderError)}),n.readAsDataURL(e),!0)})},this.addSelectedFile=function(){var e=E(r);d.insertBefore(m,l),m.appendChild(e),e.addEventListener("change",function(){M(c);var n=this.files[0],t={file:n},i=function(){w(n,a),e.parentNode.removeChild(e)};if("string"==typeof I(n))j(I(n),S.errorTimeoutId,M,c,d,s,S),e.parentNode.removeChild(e);else{var r=L(v(n),S),l=T(n.name,r,h(t.file));y(n,a),N(t,i,l),A()&&z(n,l,S),u.appendChild(e)}o.addSelectedFile()})},!A()&&S.fallbackForIE8){m.className="selectbutton js_selectbutton";var U=document.createElement("span");U.innerHTML="Select File",m.appendChild(U),o.addSelectedFile(),l.style.display="none"}l.addEventListener("drop",function(e){g(e);var n=F(e.dataTransfer.files);o.convertFilesToBase64(n),this.classList.toggle("active")}),l.addEventListener("dragenter",function(e){g(e),this.classList.toggle("active")}),l.addEventListener("dragover",function(e){g(e)}),l.addEventListener("dragleave",function(e){g(e),this.classList.toggle("active")})};return e});